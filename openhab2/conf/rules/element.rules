var Timer ON_Timer = null

rule "Element On"
when
  Time cron "0 20 9 ? * SAT,SUN *" 
  or
  Time cron "0 20 9 ? * MON-FRI *"
then
  ElementDummy.sendCommand(ON)
end

rule "Element Off"
when
  Time cron "00 05 22 * * ? *"
then
  ElementDummy.sendCommand(OFF)
end

rule "ElementDummy On"
when
  Item ElementDummy changed from OFF to ON
then
  val mode = Element_ThermostatMode.state as Number
  logInfo("Element", "On, mode = " + mode)
  if(mode != 1) {
    if(ON_Timer !== null) {
      ON_Timer.cancel()
    }
    Element_ThermostatMode.sendCommand(15)
    ON_Timer = createTimer(now.plusSeconds(4))
    [|
      Element_ThermostatMode.sendCommand(1)
      ON_Timer = null
    ]
  }
end

rule "Element Off"
when
  Item ElementDummy changed from ON to OFF
then
  val mode = Element_ThermostatMode.state as Number
  logInfo("Element", "Off, mode = " + mode)
  if(mode != 0) {
    if(ON_Timer !== null) {
      ON_Timer.cancel()
    }
    Element_ThermostatMode.sendCommand(0)
  }
end

